{% extends 'main/content.html' %}
{% load static %}
{% block title %}
5.1. Создание моделей и миграции базы данных
{% endblock %}
    {% block head %}Создание моделей и миграции базы данных{% endblock %}
{% block content %}
    
    <p>Модели в Django описывают структуру используемых данных. Используемые в программе данные хранятся в базах данных, и с помощью моделей как раз осуществляется взаимодействие с 
    базой данных.</p>
    <p>По умолчанию Django в качестве базы данных использует SQLite. Она очень проста в использовании и не требует запущенного сервера. Все файлы базы данных могут 
    легко переноситься с одного компьютера на другой. Однако при необходимости мы можем использовать в Django большинство распространенных СУБД.</p>
    <p>Для работы с базами данных в проекте Django в файле <strong>settings.py</strong> определен параметр <strong>DATABASES</strong>, 
    который по умолчанию выглядит следующим образом:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_930698" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py plain">DATABASES </code><code class="py keyword">=</code> <code class="py plain">{</code></div><div class="line number2 index1 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py string">'default'</code><code class="py plain">: {</code></div><div class="line number3 index2 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py string">'ENGINE'</code><code class="py plain">: </code><code class="py string">'django.db.backends.sqlite3'</code><code class="py plain">,</code></div><div class="line number4 index3 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py string">'NAME'</code><code class="py plain">: os.path.join(BASE_DIR, </code><code class="py string">'db.sqlite3'</code><code class="py plain">),</code></div><div class="line number5 index4 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">}</code></div><div class="line number6 index5 alt1"><code class="py plain">}</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Конфигурация используемой базы данных в данном случае складывается из двух параметров. Параметр <strong>ENGINE</strong> указывает на 
    используемый движок для доступа к БД. В данном случае это встроенный пакет <code>django.db.backends.sqlite3</code>. 
    Второй параметр - <strong>NAME</strong> указывает на путь к базе данных. После первого запуска проекта в нем по умолчанию будет создан файл 
    <code>db.sqlite3</code>, который собственно и будет использоваться в качестве базы данных.</p>
    <p>Чтобы использовать другие системы управления базами данных, необходимо будет установить соответствующий пакет.</p>
    
    <img class="displayed" src="{% static "images/5/skre1.png" %}">
    <h3>Создание моделей</h3>
    <p>При создании приложения по умолчанию в его каталог добавляется файл <strong>models.py</strong>, который применяется для определения моделей. 
    Модель представляет класс, унаследованный от <strong>django.db.models.Model</strong>.</p>
    <p>Так, изменим файл <strong>models.py</strong> следующим образом:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_489495" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django.db </code><code class="py keyword">import</code> <code class="py plain">models</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="py keyword">class</code> <code class="py plain">Person(models.Model):</code></div><div class="line number4 index3 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">models.CharField(max_length</code><code class="py keyword">=</code><code class="py value">20</code><code class="py plain">)</code></div><div class="line number5 index4 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">age </code><code class="py keyword">=</code> <code class="py plain">models.IntegerField()</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <img class="displayed" src="{% static "images/5/5.1.png" %}" alt="Создание моделей в Django">
    <p>Здесь определена простейшая модель, которая называется Person и которая представляет человека. В модели определены два поля. Поле 
    name представляет тип <code>CharField</code> - текстовое поле, которое хранит последовательность символов. Оно будет хранить имя человека. Для CharField 
    обязательно надо указать параметр <code>max_length</code>, который задает максимальную длину хранящейся строки. И поле age представляет тип <code>IntegerField</code> - числовое поле, которое хранит целые числа. Оно предназначено для хранения возраста человека.</p>
    <p>Каждая модель сопоставляется с определенной таблицей в базе данных. Однако пока у нас нет в бд таблицы, которая хранит объекты модели Person. 
    И в этом случае нам надо создать и выполнить миграцию. Миграция преобразует базу данных в соответствии с определением моделей.</p>
    <p>Вначале необходимо создать миграцию с помощью команды</p>
    <div class="console"><pre class="consoletext">python manage.py makemigrations</pre></div>
    <img class="displayed" src="{% static "images/5/5.2.png" %}" alt="Создание миграции моделей в Django">
    <p>После этого в приложении в папке <strong>migrations</strong> мы обнаружим новый файл, который будет иметь примерно следующее содержимое:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_62894" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django.db </code><code class="py keyword">import</code> <code class="py plain">migrations, models</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="py keyword">class</code> <code class="py plain">Migration(migrations.Migration):</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">initial </code><code class="py keyword">=</code> <code class="py color1">True</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">dependencies </code><code class="py keyword">=</code> <code class="py plain">[</code></div><div class="line number9 index8 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">]</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">operations </code><code class="py keyword">=</code> <code class="py plain">[</code></div><div class="line number12 index11 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">migrations.CreateModel(</code></div><div class="line number13 index12 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name</code><code class="py keyword">=</code><code class="py string">'Person'</code><code class="py plain">,</code></div><div class="line number14 index13 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">fields</code><code class="py keyword">=</code><code class="py plain">[</code></div><div class="line number15 index14 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">(</code><code class="py string">'id'</code><code class="py plain">, models.AutoField(auto_created</code><code class="py keyword">=</code><code class="py color1">True</code><code class="py plain">, primary_key</code><code class="py keyword">=</code><code class="py color1">True</code><code class="py plain">, serialize</code><code class="py keyword">=</code><code class="py color1">False</code><code class="py plain">, verbose_name</code><code class="py keyword">=</code><code class="py string">'ID'</code><code class="py plain">)),</code></div><div class="line number16 index15 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">(</code><code class="py string">'name'</code><code class="py plain">, models.CharField(max_length</code><code class="py keyword">=</code><code class="py value">20</code><code class="py plain">)),</code></div><div class="line number17 index16 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">(</code><code class="py string">'age'</code><code class="py plain">, models.IntegerField()),</code></div><div class="line number18 index17 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">],</code></div><div class="line number19 index18 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">),</code></div><div class="line number20 index19 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">]</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Это и есть миграция. Здесь можно заметить, что создается не два, а три поля - поле id, которое будет представлять первичный ключ, добавляется 
    по умолчанию. Поэтому в приниципе в самой модели нам не нужно явным образом определять какой-либо идентификатор.</p>
    <img class="displayed" src="{% static "images/5/5.3.png" %}" alt="Миграция моделей в Django">
    <p>Теперь надо выполнить данную миграцию. Для этого выполняется команда</p>
    <div class="console"><pre class="consoletext">python manage.py migrate</pre></div>
    <img class="displayed" src="{% static "images/5/5.4.png" %}" alt="Выполнение миграции базы данных в Django">
    <p>После этого, если мы откроем базу данных <strong>db.sqlite3</strong>, которая есть в проекте, в какой-нибудь специальной программе для 
    просмотра БД SQLite, то мы увидим, что она содержит ряд таблиц:</p>
    <img class="displayed" src="{% static "images/5/5.5.png" %}" alt="базы данных SQLite в Django">
    <p>В основном это будут служебные таблицы. А нас прежде всего будет интересовать таблица, которая называется по имени приложения и модели. В 
    моем случае это таблица <code>firstapp_person</code>, которая и будет хранить данные модели Person.</p>
    

{% endblock %}