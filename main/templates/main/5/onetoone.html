{% extends 'main/content.html' %}
{% load static %}
{% block title %}
5.8. Отношение один к одному (One to one)

{% endblock %}
    {% block head %}Отношение один к одному (One to one)
    {% endblock %}
{% block content %}
    
    <p>Отношение один к одному  предполагает, что одна строка из одной таблицы может быть связана только с одной сущностью из другой таблицы. 
    Например, пользователь может иметь какие-либо данные, которые описывают его учетные данные. Всю базовую информацию о пользователе, типа имени, возраста, 
    можно выделить в одну модель, а учетные данные - логин, пароль, время последнего входа в систему, количество неудачных входов и т.д. - в другую модель:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_551158" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django.db </code><code class="py keyword">import</code> <code class="py plain">models</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="py keyword">class</code> <code class="py plain">User(models.Model):</code></div><div class="line number4 index3 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">models.CharField(max_length</code><code class="py keyword">=</code><code class="py value">20</code><code class="py plain">)</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="py keyword">class</code> <code class="py plain">Account(models.Model):</code></div><div class="line number7 index6 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">login </code><code class="py keyword">=</code> <code class="py plain">models.CharField(max_length</code><code class="py keyword">=</code><code class="py value">20</code><code class="py plain">)</code></div><div class="line number8 index7 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">password </code><code class="py keyword">=</code> <code class="py plain">models.CharField(max_length</code><code class="py keyword">=</code><code class="py value">20</code><code class="py plain">)</code></div><div class="line number9 index8 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">user </code><code class="py keyword">=</code> <code class="py plain">models.OneToOneField(User, on_delete </code><code class="py keyword">=</code> <code class="py plain">models.CASCADE, primary_key </code><code class="py keyword">=</code> <code class="py color1">True</code><code class="py plain">)</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Для создания этого отношения один к одному применяется конструктор типа <strong>models.OneToOneField()</strong>. Его первый параметр 
    указывает, с какой моделью будет ассоциирована данная сущность (в данном случае ассоциация с моделью User). Второй параметр <code>on_delete = models.CASCADE</code> 
    говорит, что данные текущей модели (UserAccount) будут удаляться в случае удаления связанного объекта главной модели (User). 
    Третий параметр <code>primary_key = True</code> указывает, что внешний ключ (через который идет связь с главной моделью) в то же время будет выступать 
    и в качестве первичного ключа. И соответственно создавать отдельное поле для первичного ключа не надо.</p>
    <p>В результате миграции в базе данных SQLite будут создаваться следующие таблицы:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_909583" class="syntaxhighlighter  sql"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">`firstapp_user` (</code></div><div class="line number2 index1 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">`id`&nbsp;&nbsp;&nbsp; </code><code class="sql keyword">integer</code> <code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code> <code class="sql plain">AUTOINCREMENT,</code></div><div class="line number3 index2 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">`</code><code class="sql keyword">name</code><code class="sql plain">`&nbsp; </code><code class="sql keyword">varchar</code><code class="sql plain">(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code></div><div class="line number4 index3 alt1"><code class="sql plain">);</code></div><div class="line number5 index4 alt2"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">`firstapp_account` (</code></div><div class="line number6 index5 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">`login` </code><code class="sql keyword">varchar</code><code class="sql plain">(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number7 index6 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">`</code><code class="sql keyword">password</code><code class="sql plain">`&nbsp; </code><code class="sql keyword">varchar</code><code class="sql plain">(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number8 index7 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">`user_id`&nbsp;&nbsp; </code><code class="sql keyword">integer</code> <code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number9 index8 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code><code class="sql plain">(`user_id`),</code></div><div class="line number10 index9 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql keyword">FOREIGN</code> <code class="sql keyword">KEY</code><code class="sql plain">(`user_id`) </code><code class="sql keyword">REFERENCES</code> <code class="sql plain">`firstapp_user`(`id`) DEFERRABLE INITIALLY DEFERRED</code></div><div class="line number11 index10 alt2"><code class="sql plain">);</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <h3>Операции с моделями</h3>
    <p>С помощью свойства users в модели Account мы можем манипулировать связанным объектом модели User:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_455445" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py comments"># создадим пользователя</code></div><div class="line number2 index1 alt1"><code class="py plain">sam </code><code class="py keyword">=</code> <code class="py plain">User.objects.create(name</code><code class="py keyword">=</code><code class="py string">"Sam"</code><code class="py plain">)</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="py comments"># создадим аккаунт пользователя Sam</code></div><div class="line number5 index4 alt2"><code class="py plain">acc </code><code class="py keyword">=</code> <code class="py plain">Account.objects.create(login </code><code class="py keyword">=</code> <code class="py string">"1234"</code><code class="py plain">, password</code><code class="py keyword">=</code><code class="py string">"6565"</code><code class="py plain">, user</code><code class="py keyword">=</code><code class="py plain">sam)</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="py comments"># изменяем имя пользователя</code></div><div class="line number8 index7 alt1"><code class="py plain">acc.user.name </code><code class="py keyword">=</code> <code class="py string">"Bob"</code></div><div class="line number9 index8 alt2"><code class="py comments"># сохраняем изменения в бд</code></div><div class="line number10 index9 alt1"><code class="py plain">acc.user.save()</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Однако через модель User мы также можем оказывать влияние на связанный объект Account. Несмотря на то, что явным образом в модели User определено только 
    одно свойство - name, при связи один к одному неявно создается еще одно свойство, которое называется по имени зависимой модели и которое указывает на 
    связанный объект этой модели. То есть в данном случае это свойство будет называться "account":</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_144035" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py comments"># создадим пользователя</code></div><div class="line number2 index1 alt1"><code class="py plain">tom </code><code class="py keyword">=</code> <code class="py plain">User.objects.create(name</code><code class="py keyword">=</code><code class="py string">"Tom"</code><code class="py plain">)</code></div><div class="line number3 index2 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="py comments"># создадим аккаунт пользователя</code></div><div class="line number5 index4 alt2"><code class="py plain">acc </code><code class="py keyword">=</code> <code class="py plain">Account(login </code><code class="py keyword">=</code> <code class="py string">"1234"</code><code class="py plain">, password</code><code class="py keyword">=</code><code class="py string">"6565"</code><code class="py plain">)</code></div><div class="line number6 index5 alt1"><code class="py plain">tom.account </code><code class="py keyword">=</code> <code class="py plain">acc</code></div><div class="line number7 index6 alt2"><code class="py plain">tom.account.save()</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="py comments"># обновляем данные</code></div><div class="line number10 index9 alt1"><code class="py plain">tom.account.login </code><code class="py keyword">=</code> <code class="py string">"qwerty"</code></div><div class="line number11 index10 alt2"><code class="py plain">tom.account.password </code><code class="py keyword">=</code> <code class="py string">"123456"</code></div><div class="line number12 index11 alt1"><code class="py plain">tom.account.save()</code></div></div></td></tr></tbody></table></div></div>
    </nav>

{% endblock %}