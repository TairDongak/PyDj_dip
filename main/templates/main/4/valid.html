{% extends 'main/content.html' %}
{% load static %}
{% block title %}
4.4. Валидация данных
{% endblock %}
    {% block head %}Валидация данных{% endblock %}
{% block content %}


    
    <p>Теоретически пользователь может ввести в форму какие угодно данные и отправить их. Однако не все данные бывают уместными или корректными. Например, в поле для возраста пользователь может ввести 
    отрицательное число, что вряд ли может считаться корректным возрастом. В этой связи для проверки корректности вводимых данных используется механизм валидации.</p>
    <h3>Правила валидации</h3>
    <p>Основным элементом валидаии являются правила, которые задают параметры корректности вводимых данных. Например, для всех поле по умолчанию 
    устанавливается обязательность ввода значения. И при генерации html-кода для поля ввода устанавливается атрибут <span class="b">required</span>. 
    И если мы попробуем отправить форму, если какое-то из ее полей не введено никакого значения, то мы получим ошибку:</p>
    <img class="displayed" src="{% static "images/4/4.7.png" %}" alt="Required attribute in Django Forms">
    <p>И нам надо будет обязательно ввести какое-то значение в незаполненное поле. Однако это не всегда нужно. Допустим, одно поле может иметь, а может не иметь значение. 
    В этом случае мы можем отключить атрибут required:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_57194" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django </code><code class="py keyword">import</code> <code class="py plain">forms</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="py keyword">class</code> <code class="py plain">UserForm(forms.Form):</code></div><div class="line number4 index3 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">forms.CharField()</code></div><div class="line number5 index4 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">age </code><code class="py keyword">=</code> <code class="py plain">forms.IntegerField(required</code><code class="py keyword">=</code><code class="py color1">False</code><code class="py plain">)</code></div><div class="line number6 index5 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">email </code><code class="py keyword">=</code> <code class="py plain">forms.EmailField(required</code><code class="py keyword">=</code><code class="py color1">False</code><code class="py plain">)</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <h4>Длина текста</h4>
    <p>Для полей, которые требуют ввода текста, например, <code>CharField</code>, <code>EmailField</code> и др., с помощью параметров 
    <span class="b">max_length</span> и <span class="b">min_length</span> можно задать соответственно максимальную и минимальную длину вводимого текста в символах.</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_251139" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django </code><code class="py keyword">import</code> <code class="py plain">forms</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="py keyword">class</code> <code class="py plain">UserForm(forms.Form):</code></div><div class="line number4 index3 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">forms.CharField(min_length</code><code class="py keyword">=</code><code class="py value">2</code><code class="py plain">, max_length</code><code class="py keyword">=</code><code class="py value">20</code><code class="py plain">)</code></div><div class="line number5 index4 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">email </code><code class="py keyword">=</code> <code class="py plain">forms.EmailField(required</code><code class="py keyword">=</code><code class="py color1">False</code><code class="py plain">, min_length</code><code class="py keyword">=</code><code class="py value">7</code><code class="py plain">)</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>При генерации разметки для полей ввода будут устанавливаться атрибуты <code>maxlength</code> и <code>minlength</code>.</p>
    <h4>Минимальное и максимальное число</h4>
    <p>Для объектов <span class="b">IntegerField</span>, <span class="b">DecimalField</span> и <span class="b">FloatField</span> можно устанавливать параметры 
    <span class="b">max_value</span> и <span class="b">min_value</span>, которые задают соответственно максимально допустимое и минимально допустимое 
    значение.</p>
    <p>DecimalField дополнительно может принимать еще параметр <span class="b">decimal_places</span>, который указывает на максимальное количество 
    знаков после запятой.</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_877411" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django </code><code class="py keyword">import</code> <code class="py plain">forms</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="py keyword">class</code> <code class="py plain">UserForm(forms.Form):</code></div><div class="line number4 index3 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">forms.CharField()</code></div><div class="line number5 index4 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">age </code><code class="py keyword">=</code> <code class="py plain">forms.IntegerField(min_value</code><code class="py keyword">=</code><code class="py value">1</code><code class="py plain">, max_value</code><code class="py keyword">=</code><code class="py value">100</code><code class="py plain">)</code></div><div class="line number6 index5 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">weight </code><code class="py keyword">=</code> <code class="py plain">forms.DecimalField(min_value</code><code class="py keyword">=</code><code class="py value">3</code><code class="py plain">, max_value</code><code class="py keyword">=</code><code class="py value">200</code><code class="py plain">, decimal_places</code><code class="py keyword">=</code><code class="py value">2</code><code class="py plain">)</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <h3>is_valid</h3>
    <p>Выше рассмотренные атрибуты позволяют валидировать значения при вводе на стороне клиента. Однако практически пользователя, имея определенные навыки, могут все равно отправить 
    форму с заведомо некорректными данными. Например, через инструменты для разработчиков в веб-браузере можно подправить исходный код формы, добавив ей атрибут novalidate, 
    который отключает клиентскую валидацию. Поэтому проверку на валидность данных также надо определять на стороне сервера. Для этого у формы вызывается 
    метод <span class="b">is_valid()</span>, который возвращает True, если данные корректны, и False - если данные некорректны. Чтобы использоать этот метод, надо создать объект формы и 
    передать ей пришедшие из запроса данные.</p>
    <p>Итак, определим следующее представление в файле <span class="b">views.py</span>:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_29176" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django.shortcuts </code><code class="py keyword">import</code> <code class="py plain">render</code></div><div class="line number2 index1 alt1"><code class="py keyword">from</code> <code class="py plain">django.http </code><code class="py keyword">import</code> <code class="py plain">HttpResponse</code></div><div class="line number3 index2 alt2"><code class="py keyword">from</code> <code class="py plain">.forms </code><code class="py keyword">import</code> <code class="py plain">UserForm</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="py keyword">def</code> <code class="py plain">index(request):</code></div><div class="line number6 index5 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">request.method </code><code class="py keyword">=</code><code class="py keyword">=</code> <code class="py string">"POST"</code><code class="py plain">:</code></div><div class="line number7 index6 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">userform </code><code class="py keyword">=</code> <code class="py plain">UserForm(request.POST)</code></div><div class="line number8 index7 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">userform.is_valid():</code></div><div class="line number9 index8 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">userform.cleaned_data[</code><code class="py string">"name"</code><code class="py plain">]</code></div><div class="line number10 index9 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py plain">HttpResponse(</code><code class="py string">"&lt;h2&gt;Hello, {0}&lt;/h2&gt;"</code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(name))</code></div><div class="line number11 index10 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">else</code><code class="py plain">:</code></div><div class="line number12 index11 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py plain">HttpResponse(</code><code class="py string">"Invalid data"</code><code class="py plain">)</code></div><div class="line number13 index12 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">else</code><code class="py plain">:</code></div><div class="line number14 index13 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">userform </code><code class="py keyword">=</code> <code class="py plain">UserForm()</code></div><div class="line number15 index14 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py plain">render(request, </code><code class="py string">"index.html"</code><code class="py plain">, {</code><code class="py string">"form"</code><code class="py plain">: userform})</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Если приходит POST-запрос, то в начале заполняем форму пришедшими данными:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_181134" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py plain">userform </code><code class="py keyword">=</code> <code class="py plain">UserForm(request.POST)</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Потом проверяем их корректность:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_823005" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">if</code> <code class="py plain">userform.is_valid():</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>После проверки на валидность мы можем получить данные через объект cleaned_data (если данные корректны):</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_634657" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">userform.cleaned_data[</code><code class="py string">"name"</code><code class="py plain">]</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Если данные некорректны, можно предусмотреть альтернативный вывод:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_959601" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">return</code> <code class="py plain">HttpResponse(</code><code class="py string">"Invalid data"</code><code class="py plain">)</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Для тестирования формы можно установить у ней атрибут <span class="b">novalidate</span>:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_530065" class="syntaxhighlighter  xml"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">form</code> <code class="xml color1">method</code><code class="xml plain">=</code><code class="xml string">"POST"</code> <code class="xml plain">novalidate&gt;</code></div><div class="line number2 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{% csrf_token %}</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">table</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{{ form }}</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">table</code><code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">input</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"submit"</code> <code class="xml color1">value</code><code class="xml plain">=</code><code class="xml string">"Send"</code> <code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">form</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
    </nav>


{% endblock %}