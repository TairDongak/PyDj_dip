{% extends 'main/content.html' %}
{% load static %}
{% block title %}
4.1. Определение форм
{% endblock %}
    {% block head %}Определение форм{% endblock %}
{% block content %}


    
    <p>Django предоставляет специальные возможности по работе с формами, которые позволяют определять функциональноть форм в одном месте и использовать многократно в разных местах, упрощают 
    валидацию данных, помогают связывать формы с моделями и многое другое.</p>
    <p>Каждая форма определяется в виде отдельного класса, который расширяет класс <strong>forms.Form</strong>. Классы размещаются 
    внутри проекта, где они используются. Нередко они помещаются в отдельный файл, который называется, к примеру, <code>forms.py</code>. 
    Однако также формы могут размещаться внутри уже имеющихся в приложении файлов, например, в <code>views.py</code> или <code>models.py</code>.</p>
    <p>Например, создадим в приложении новый файл <strong>forms.py</strong> и поместим в него следующий код:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_92757" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django </code><code class="py keyword">import</code> <code class="py plain">forms</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="py keyword">class</code> <code class="py plain">UserForm(forms.Form):</code></div><div class="line number4 index3 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">forms.CharField()</code></div><div class="line number5 index4 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">age </code><code class="py keyword">=</code> <code class="py plain">forms.IntegerField()</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Класс формы называется UserForm. Он определяет два поля. Поле name представляет тип forms.CharField и будет генерировать поле <code>input type="text"</code>. 
    Поле age представляет тип forms.IntegerField и будет генерировать поле <code>input type="number"</code>. То есть первое поле дял ввода текста, а второе для ввода чисел.</p>
    <img class="displayed" src="{% static "images/4/4.1.png" %}" alt="Forms in Django">
    <p>Далее в файле views.py определим следующее представление:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_152946" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django.shortcuts </code><code class="py keyword">import</code> <code class="py plain">render</code></div><div class="line number2 index1 alt1"><code class="py keyword">from</code> <code class="py plain">.forms </code><code class="py keyword">import</code> <code class="py plain">UserForm</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="py keyword">def</code> <code class="py plain">index(request):</code></div><div class="line number5 index4 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">userform </code><code class="py keyword">=</code> <code class="py plain">UserForm()</code></div><div class="line number6 index5 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py plain">render(request, </code><code class="py string">"index.html"</code><code class="py plain">, {</code><code class="py string">"form"</code><code class="py plain">: userform})</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Здесь объект формы передается в шаблон index.html в виде переменной form.</p>
    <p>И определим следующий шаблон <strong>index.html</strong>:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_702146" class="syntaxhighlighter  xml"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;!DOCTYPE html&gt;</code></div><div class="line number2 index1 alt1"><code class="xml plain">&lt;</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">meta</code> <code class="xml color1">charset</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code> <code class="xml plain">/&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">title</code><code class="xml plain">&gt;Django Forms&lt;/</code><code class="xml keyword">title</code><code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">table</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{{ form }}</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">table</code><code class="xml plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number12 index11 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>В итоге из переменной form будет генерироваться следующий код html:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_895291" class="syntaxhighlighter  xml"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">tr</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">th</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">label</code> <code class="xml color1">for</code><code class="xml plain">=</code><code class="xml string">"id_name"</code><code class="xml plain">&gt;Name:&lt;/</code><code class="xml keyword">label</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">th</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">td</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">input</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"text"</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"name"</code> <code class="xml plain">required </code><code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"id_name"</code> <code class="xml plain">/&gt;&lt;/</code><code class="xml keyword">td</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">tr</code><code class="xml plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="xml plain">&lt;</code><code class="xml keyword">tr</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">th</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">label</code> <code class="xml color1">for</code><code class="xml plain">=</code><code class="xml string">"id_age"</code><code class="xml plain">&gt;Age:&lt;/</code><code class="xml keyword">label</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">th</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">td</code><code class="xml plain">&gt;&lt;</code><code class="xml keyword">input</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"number"</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"age"</code> <code class="xml plain">required </code><code class="xml color1">id</code><code class="xml plain">=</code><code class="xml string">"id_age"</code> <code class="xml plain">/&gt;&lt;/</code><code class="xml keyword">td</code><code class="xml plain">&gt;&lt;/</code><code class="xml keyword">tr</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <img class="displayed" src="{% static "images/4/4.2.png" %}" alt="Формы в Django">
    <h3>Получение POST-запроса</h3>
    <p>Теперь с помощью форм Django определим полнофункциональную форму, с которой можно отправлять данные на сервер.</p>
    <p>Вначале изменим шаблон <strong>index.html</strong>:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_489564" class="syntaxhighlighter  xml"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;!DOCTYPE html&gt;</code></div><div class="line number2 index1 alt1"><code class="xml plain">&lt;</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">meta</code> <code class="xml color1">charset</code><code class="xml plain">=</code><code class="xml string">"utf-8"</code> <code class="xml plain">/&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">title</code><code class="xml plain">&gt;Django Forms&lt;/</code><code class="xml keyword">title</code><code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">head</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">form</code> <code class="xml color1">method</code><code class="xml plain">=</code><code class="xml string">"POST"</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{% csrf_token %}</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">table</code><code class="xml plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">{{ form }}</code></div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">table</code><code class="xml plain">&gt;</code></div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">input</code> <code class="xml color1">type</code><code class="xml plain">=</code><code class="xml string">"submit"</code> <code class="xml color1">value</code><code class="xml plain">=</code><code class="xml string">"Send"</code> <code class="xml plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">form</code><code class="xml plain">&gt;</code></div><div class="line number15 index14 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">body</code><code class="xml plain">&gt;</code></div><div class="line number16 index15 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">html</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Для создания формы здесь использован стандартный элемент html <code>&lt;form&gt;</code>. В начале формы помещен встроенный тег Django 
    <strong>{% csrf_token %}</strong>, который позволяет защитить приложение от CSRF-атак, добавляя в форму в виде скрытого поля csrf-токен.</p>
    <p>Внизу формы определена кнопка для отправки данной формы на сервер.</p>
    <p>Теперь изменим представление в файле <strong>views.py</strong>:</p>
    <nav class="navbar navbar-light" style="background-color: #e3f2fd;">
    <div><div id="highlighter_533267" class="syntaxhighlighter  py"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help"></a></strong></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="py keyword">from</code> <code class="py plain">django.shortcuts </code><code class="py keyword">import</code> <code class="py plain">render</code></div><div class="line number2 index1 alt1"><code class="py keyword">from</code> <code class="py plain">django.http </code><code class="py keyword">import</code> <code class="py plain">HttpResponse</code></div><div class="line number3 index2 alt2"><code class="py keyword">from</code> <code class="py plain">.forms </code><code class="py keyword">import</code> <code class="py plain">UserForm</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="py keyword">def</code> <code class="py plain">index(request):</code></div><div class="line number6 index5 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">if</code> <code class="py plain">request.method </code><code class="py keyword">=</code><code class="py keyword">=</code> <code class="py string">"POST"</code><code class="py plain">:</code></div><div class="line number7 index6 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">name </code><code class="py keyword">=</code> <code class="py plain">request.POST.get(</code><code class="py string">"name"</code><code class="py plain">)</code></div><div class="line number8 index7 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py comments"># age = request.POST.get("age")&nbsp;&nbsp;&nbsp;&nbsp; # получение значения поля age</code></div><div class="line number9 index8 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py plain">HttpResponse(</code><code class="py string">"&lt;h2&gt;Hello, {0}&lt;/h2&gt;"</code><code class="py plain">.</code><code class="py functions">format</code><code class="py plain">(name))</code></div><div class="line number10 index9 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">else</code><code class="py plain">:</code></div><div class="line number11 index10 alt2"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py plain">userform </code><code class="py keyword">=</code> <code class="py plain">UserForm()</code></div><div class="line number12 index11 alt1"><code class="py spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="py keyword">return</code> <code class="py plain">render(request, </code><code class="py string">"index.html"</code><code class="py plain">, {</code><code class="py string">"form"</code><code class="py plain">: userform})</code></div></div></td></tr></tbody></table></div></div>
    </nav>
    <p>Поскольку в шаблоне форма по умолчанию будет отправляться на тот же адрес, то представление обабатывает сразу да типа запросов GET и POST. Для определения типа 
    запроса проверяем значение <code>request.method</code>.</p>
    <p>Если запрос типа POST, то вначале создаем объект UserForm, наполняя его данными, которые пришли в запросе через request.POST. То есть это и будут отправленные 
    данные формы. Затем мы можем получить эти данные по отдельности для каждого поля формы. После этого отправляем пользователю сообещние через объект HttpResponse. В прицние тут можно было бы сделать переадресацию или использовать другой шаблон для генерации ответа.</p>
    <p>Если запрос представляет тип GET, то просто отправляем форму для ввода данных.</p>
    <p>Таким образом, при обращении к приложению мы вначале увидим форму ввода. Введем в нее некоторые данные:</p>
    <img class="displayed" src="{% static "images/4/4.3.png" %}" alt="Обработка ввода в формах Django">
    <p>После нажатия на кнопку введенные данные в запросе POST опять же уйдут преставлению index, которое обработает их и в ответ отправить пользователю 
    сообщение с введенным именем:</p>
    <img class="displayed" src="{% static "images/4/4.4.png" %}" alt="Запросы POST в формах Django">

{% endblock %}